<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${post.title}">게시글 제목</title>
    <link rel="stylesheet" href="/css/post-detail.css">
</head>
<body>
<header class="header">
    <li class="logo"><a href="/">JPOPJ</a></li>
    <li class="login-btn-container">
        <a th:if="${session.user==null}" th:href="@{/login}" class="login-btn">로그인</a>

        <a th:if="${session.user != null}" th:href = "@{/profile}" class="profile-icon">
            <img src="/images/user-icon2.png" alt="내 정보" width="33px"/>
        </a>
    </li>
</header>

<nav class="tag-nav">
    <ul>
        <li th:classappend="${activeCategory == 'NEW' ? 'active' : ''}"><a th:href="@{/NEW}">NEW</a></li>
        <li th:classappend="${activeCategory == 'ARTIST' ? 'active' : ''}"><a th:href="@{/ARTIST}">ARTIST</a></li>
        <li th:classappend="${activeCategory == 'REVIEW' ? 'active' : ''}"><a th:href="@{/REVIEW}">REVIEW</a></li>
        <li th:classappend="${activeCategory == 'TALK' ? 'active' : ''}"><a th:href="@{/TALK}">TALK</a></li>
        <li th:classappend="${activeCategory == 'CONCERT' ? 'active' : ''}"><a th:href="@{/CONCERT}">CONCERT</a></li>
        <li class="write-btn-container">
            <a th:href="@{/write}" class="write-btn">글 작성하기</a>
        </li>
    </ul>
</nav>
<div class="post-container">
    <h1 class="post-title" th:text="${post.title}">제목</h1>

    <div class="post-meta">
        <span class="post-author" th:text="${post.userNickname}">작성자</span> |
        <span class="post-date" th:text="${#temporals.format(post.createdDate, 'yyyy-MM-dd HH:mm')}">작성일</span>
    </div>

    <hr class="divider"/>

    <div class="post-content" th:utext="${post.content}">
        게시글 본문
    </div>

    <!-- 댓글 영역 시작 -->
    <div class="comment-section">
        <h2>댓글</h2>

        <!-- 댓글 목록 -->
        <div class="comment-list">
            <div th:if="${#lists.isEmpty(comments)}">
                <p>아직 댓글이 없습니다.</p>
            </div>

            <div th:each="comment : ${comments}" class="comment-item">
                <div class="comment-meta">
                    <strong th:text="${comment.userNickname}">작성자</strong>
                    <span th:text="${#temporals.format(comment.createdDate, 'yyyy-MM-dd HH:mm')}">작성일</span>
                </div>
                <div class="comment-content" th:text="${comment.content}">댓글 내용</div>
            </div>
        </div>

        <hr/>

        <!-- 댓글 작성 폼 -->
        <div class="comment-form" th:if="${session.user != null}">
            <form th:action="@{'/posts/'+${post.postId}+ '/comments'}" method="post">
                <input type="hidden" name="postId" th:value="${post.postId}"/>
                <input type="hidden" name="userId" th:value="${session.user.id}"/>
                <textarea name="content" placeholder="댓글을 입력하세요..." required></textarea>
                <button type="submit">댓글 작성하기</button>
            </form>
        </div>

        <div th:if="${session.user == null}">
            <p><a th:href="@{/login}">로그인</a> 후 댓글을 작성할 수 있습니다.</p>
        </div>
    </div>
    <!-- 댓글 영역 끝 -->

    <div class="post-actions">
        <a th:href="@{'/' + ${post.category}}" class="btn-back">← 목록으로</a>

        <!-- 삭제 버튼 (작성자만 보이게)-->
        <button th:if ="${session.user != null and session.user.id == post.userId}"
                type ="button" class="btn-delete"
                th:onclick="|deletePost(${post.postId})|">삭제</button>
    </div>

</div>
<script src="/js/post-delete.js"></script>
</body>
</html>
